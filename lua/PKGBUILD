
pkgname=lua 
pkgver=5.2.4
pkgrel=1
pkgdesc="A powerful light-weight programming language designed for extending applications." 
arch=('x86_64')
url="https://www.lua.org/" 
depends=('readline' 'ncurses') 
license=('MIT')
options=('!makeflags' '!emptydirs')
source=("https://www.lua.org/ftp/${pkgname}-${pkgver}.tar.gz"
        'lua-arch.patch'
        'lua.pc')
sha1sums=('ef15259421197e3d85b7d6e4871b8c26fd82c1cf'
          '84bf5c3fed26e6a3e317a8f29cbdc68fc3607cf5'
          'efdf59c5f914eaae26877491ea882e7f41ab866f')

build() { 
  cd ${pkgname}-${pkgver}
  patch -p1 -i ${srcdir}/lua-arch.patch
  #patch -p1 -i ${srcdir}/lua-5.1-cflags.diff
  
  export CFLAGS="$CFLAGS -fPIC"
  make MYCFLAGS="$CFLAGS" MYLDFLAGS="$LDFLAGS" linux
}

package() {
  cd ${pkgname}-${pkgver}
  make INSTALL_DATA="cp -d" \
    TO_LIB="liblua.a liblua.so liblua.so.5.2 liblua.so.${pkgver}" \
    INSTALL_TOP=${pkgdir}/usr \
    INSTALL_MAN=${pkgdir}/usr/share/man/man1 \
    install
    
  install -D -m644 ../../lua.pc ${pkgdir}/usr/lib/pkgconfig/lua.pc
  install -D -m644 doc/readme.html ${pkgdir}/usr/share/licenses/${pkgname}/readme.html

  install -d ${pkgdir}/usr/share/doc/lua
  install -m644 doc/*.{gif,png,css,html} ${pkgdir}/usr/share/doc/lua
}
