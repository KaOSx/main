#
# Platform Packages for Chakra, part of chakra-project.org
#

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=portaudio-svn
pkgver=1870
pkgrel=1
pkgdesc="PortAudio is a free, cross platform, open-source, audio I/O library."
arch=('i686' 'x86_64')
url="http://www.portaudio.com"
license="custom"
depends=('jack')
makedepends=('subversion')
conflicts=('portaudio')
provides=('portaudio')

_svntrunk=https://subversion.assembla.com/svn/portaudio/portaudio/trunk
_svnmod=trunk


build() {
  msg "Connecting to SVN server...."

  if [[ -d "${_svnmod}/.svn" ]]; then
    (cd "${_svnmod}" && svn up -r "${pkgver}")
  else
    svn co "${_svntrunk}" --config-dir ./ -r "${pkgver}" "${_svnmod}"
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting cmake and build..."

  rm -rf "${srcdir}/${_svnmod}-build"
  svn export --quiet "${srcdir}/${_svnmod}" "${srcdir}/${_svnmod}-build"
  cd "${srcdir}/${_svnmod}-build"

  ./configure --prefix=/usr --with-alsa --with-jack
  make
}

package() {
  cd $_svnmod-build
  make DESTDIR=$startdir/pkg install
  install -D -m644 LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt"
}
