
# NOTE: Disabled the gtk2 module so no gtk-preview

pkgname=mlt
pkgver=6.16.0
pkgrel=2
pkgdesc="An open source multimedia framework"
arch=('x86_64')
url="http://www.mltframework.org"
license=('GPL')
depends=('sdl_image' 'libsamplerate' 'libdv' 'sox' 'libxml2' 'ffmpeg' 'python3' 'jack' 'ladspa' 'qt5-svg'
         'frei0r-plugins' 'libexif' 'opencv')
makedepends=('swig')
source=("https://github.com/mltframework/mlt/releases/download/v${pkgver}/mlt-${pkgver}.tar.gz"
        "https://github.com/mltframework/mlt/commit/12d4f46a957ab4eba155940b44bb31c35697da26.diff"
        "https://github.com/mltframework/mlt/commit/3dbe5bcb87a26895ffc80aad3d6eac3539c161dd.diff"
        "https://github.com/mltframework/mlt/commit/1ece7ea5906e6ed06d364390234f3ca355f9850f.diff")
md5sums=('e3872267232aae89f5182fd567be2596'
         '57f093194bdacdafe197bf8036c0336f'
         '837b140a842f5746d2c0245d341a2fb4'
         '602b6ad7185d40f081ba92d027d9ea4f')

build() {
  cd mlt-${pkgver}
  patch -p1 -i ${srcdir}/12d4f46a957ab4eba155940b44bb31c35697da26.diff
  patch -p1 -i ${srcdir}/3dbe5bcb87a26895ffc80aad3d6eac3539c161dd.diff
  patch -p1 -i ${srcdir}/1ece7ea5906e6ed06d364390234f3ca355f9850f.diff
  
  #CXXFLAGS="-std=c++11"

  ./configure --prefix=/usr \
              --enable-gpl \
              --enable-gpl3 \
              --qimage-libdir=/usr/lib/ \
              --qt-includedir=/usr/include/qt \
              --disable-gtk2 \
              --avformat-swscale \
              --enable-opencv
  make

  # mlt python bindings
  cd src/swig/python
  ./build
}

package () {
  cd mlt-${pkgver}
  make DESTDIR=${pkgdir} install
  
  # install python bindings
  cd src/swig/python
  mkdir -p ${pkgdir}/usr/lib/python3.7/
  install -m0755 mlt.py ${pkgdir}/usr/lib/python3.7/
  install -m0755 _mlt.so ${pkgdir}/usr/lib/python3.7/
  install -m0755 mlt_wrap.o ${pkgdir}/usr/lib/python3.7/
}
