
pkgname=xorg-server-utils
pkgver=7.13
pkgrel=1
pkgdesc="X.Org utilities required by xorg-server"
arch=('x86_64')
url="https://xorg.freedesktop.org/"
license=('custom')
depends=('libxfontcache' 'libxi' 'libxaw' 'libxrandr' 'libxxf86vm' 'mcpp'
         'xcb-util' 'libxinerama' 'libxcursor')
makedepends=('pkgconfig' 'xbitmaps' 'xorgproto' 'xtrans' 'xorg-util-macros')
groups=('xorg')
source=("https://xorg.freedesktop.org/releases/individual/app/iceauth-1.0.8.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/rgb-1.0.6.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/sessreg-1.1.1.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xcmsdb-1.0.5.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xbacklight-1.2.2.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xgamma-1.0.6.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xhost-1.0.7.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xinput-1.6.2.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xmodmap-1.0.9.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xrandr-1.5.0.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xrdb-1.1.1.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xrefresh-1.0.6.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xset-1.2.4.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xsetmode-1.0.0.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xsetroot-1.1.2.tar.bz2"
        "https://xorg.freedesktop.org/releases/individual/app/xvidtune-1.0.3.tar.bz2"
        'LICENSE.iceauth'
        'LICENSE.xcmsdb'
        'LICENSE.xvidtune')
sha256sums=('e6ee213a217265cc76050e4293ea70b98c32dce6505c6421227efbda62ab60c6'
            'bbca7c6aa59939b9f6a0fb9fff15dfd62176420ffd4ae30c8d92a6a125fbe6b0'
            '78a76ae3f3f6a26547a34630d1b740f42344848b5fb6d7c9c7f7da255e35a6e1'
            'e5585361bb8b6a05bb814a8d0e444ee93e0f00180881d3070aff4571e97f67c6'
            '615a1d13e429ed5a0300b2f4508bc199d7cf21b6b9f088a9d8188d3bc957bf5e'
            '0ef1c35b5c18b1b22317f455c8df13c0a471a8efad63c89c98ae3ce8c2b222d3'
            '93e619ee15471f576cfb30c663e18f5bc70aca577a63d2c2c03f006a7837c29a'
            '3694d29b4180952fbf13c6d4e59541310cbb11eef5bf888ff3d8b7f4e3aee5c4'
            'b7b0e5cc5f10d0fb6d2d6ea4f00c77e8ac0e847cc5a73be94cd86139ac4ac478'
            'c1cfd4e1d4d708c031d60801e527abc9b6d34b85f2ffa2cadd21f75ff38151cd'
            '2d23ade7cdbb487996bf77cbb32cbe9bdb34d004748a53de7a4a97660d2217b7'
            '287dfb9bb7e8d780d07e672e3252150850869cb550958ed5f8401f0835cd6353'
            'e4fd95280df52a88e9b0abc1fee11dcf0f34fc24041b9f45a247e52df941c957'
            '988b47cd922991c6e6adbce15dc386ac75690b61744b526c3af5a4eaa9afa0aa'
            '10c442ba23591fb5470cea477a0aa5f679371f4f879c8387a1d9d05637ae417c'
            '24e5e103933a04bfb2e1d18562619ed74031ab515e7343eb546bacdbcbeecf01'
            '4eb502e7400920e38b7680fb6b5a46d2b5a098e91caadc5f61ffe05d3d0ee681'
            '786776b1cc89ea0494589f9aa83ac653b7cddb8eeccb94b34b084ad4e54efe3b'
            'a8753d4a476a3fcdfe0aed574604588c24565a991cb7f2be1f1106a17f56339b')

build() {
  cd "${srcdir}"
  
  for i in *; do
    if [ -d "${i}" ]; then
      pushd "${i}"
      case "${i}" in
        xrdb*)
          ./configure --prefix=/usr --mandir=/usr/share/man --with-cpp=/usr/bin/mcpp 
          ;;
        *)
          ./configure --prefix=/usr --mandir=/usr/share/man
          ;;
      esac
      make
      popd
    fi
  done
}

package() {
  cd "${srcdir}"
  
  for i in *; do
    if [ -d "${i}" ]; then
      pushd "${i}"
      make DESTDIR="${pkgdir}" install
      install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
      install -m644 COPYING "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE.${i%-*}
      popd
    fi
  done

  # Replacing stub license files
  install -m644 "${srcdir}"/LICENSE.* "${pkgdir}/usr/share/licenses/${pkgname}/"
}
