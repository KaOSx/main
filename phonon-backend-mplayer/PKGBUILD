#
# Phonon Packages for Chakra, part of chakra-project.org
#
# maintainer abveritas@chakra-project.org

pkgname=('phonon-backend-mplayer')
_pkgname=('phonon-mplayer')
pkgver=20120212
pkgrel=9
pkgdesc='Phonon MPlayer backend'
arch=('x86_64')
url='http://phonon.kde.org'
license=('LGPL')
depends=('phonon' 'mplayer')
makedepends=('qt' 'pkgconfig' 'cmake' 'automoc4' 'git' 'mesa')
groups=("kde-complete" "kde-uninstall")
conflicts=("phonon-mplayer-svn" 'phonon-mplayer')
replaces=("phonon-mplayer-svn" 'phonon-mplayer')
source=("http://chakra-linux.org/sources/${pkgname}/${pkgname}-${pkgver}.tar.xz"
        "find-config.patch")
md5sums=('3e4334033ff7930a9b2a55a8b46fc9db'
         '55a20d7146371fbf1f1139a2ed874604')

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf ${pkgname}-${pkgver}
	  git clone git://anongit.kde.org/${_pkgname}.git ${pkgname}-${pkgver}
	  rm -vRf ${pkgname}-${pkgver}/.git
	  pushd ${pkgname}-${pkgver}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}.tar.xz ${pkgname}-${pkgver}/*
	  md5sum ${pkgname}-${pkgver}.tar.xz
}

build() {
	cd "$srcdir/${pkgname}-${pkgver}"
	patch -Np1 -i ${srcdir}/find-config.patch

	msg "Starting make..."

	# Config
	[ ${CARCH} = 'x86_64' ] && CXXFLAGS="$CXXFLAGS -fPIC"

	# Build
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release \
		-DPLUGIN_INSTALL_DIR=/usr/lib/kde4 -DSERVICES_INSTALL_DIR=/usr/share/kde4/services .
	make
}

package() {
	cd "$srcdir/${pkgname}-${pkgver}"
	make DESTDIR=${pkgdir} install
	rm -rf "${srcdir}/${_gitname}-build"
}

