
pkgname=clamz
pkgver=0.5
pkgrel=4
pkgdesc="Command-line program to download MP3 files from Amazon.com's music store."
arch=('x86_64')
url='https://code.google.com/archive/p/clamz/'
license=('GPL3')
depends=('libgcrypt' 'curl' 'expat' 'shared-mime-info' 'desktop-file-utils')
source=("https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/clamz/clamz-${pkgver}.tar.gz"
        'clamz_download_user_agent.patch')
md5sums=('84543c9346b285bdc218879e241941a8'
         'af67a6be6ff850bf625b5724bf4cc2af')

build() {
    cd ${pkgname}-${pkgver}
    sed -i 's|$(UPDATE_DESKTOP_DATABASE)\ $(DESTDIR)$(applications_dir)||' Makefile.in
    sed -i 's|$(UPDATE_MIME_DATABASE)\ $(DESTDIR)$(mime_dir)||' Makefile.in
    # see https://github.com/wlevine/clamz/issues/40
    patch -p1 -i $srcdir/clamz_download_user_agent.patch

    ./configure --prefix=/usr/
    make
}

package() {
    cd ${pkgname}-${pkgver}

    make DESTDIR=${pkgdir} install
}
